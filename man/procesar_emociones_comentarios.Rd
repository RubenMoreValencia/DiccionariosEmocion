% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/visualizacion_modelos.R
\name{procesar_emociones_comentarios}
\alias{procesar_emociones_comentarios}
\title{Procesar emociones por comentario con traducción y clustering}
\usage{
procesar_emociones_comentarios(
  lista_tokens,
  matriz_emociones_traducida,
  metodo_lexico = "syuzhet",
  k = 4,
  nstart = 20,
  seed = 123,
  resumen_fun = c("sum", "mean"),
  columnas_map = NULL,
  na_action = c("omit", "zero", "fail"),
  devolver_etiquetas = TRUE
)
}
\arguments{
\item{lista_tokens}{\code{list} de vectores (tokens por comentario) en el mismo orden
que quieras en la salida.}

\item{matriz_emociones_traducida}{\code{data.frame} o \code{matrix} con filas = tokens,
columnas = emociones/polaridades (p. ej. NRC + \code{positive}/\code{negative}).}

\item{metodo_lexico}{\code{character}. Nombre del método léxico a usar para
\code{obtener_palabra_mas_emocional()} (solo si esa helper está disponible).
Por defecto \code{"syuzhet"}.}

\item{k}{\code{integer}. Número de clusters para \code{kmeans}. Por defecto \code{4}.}

\item{nstart}{\code{integer}. Reintentos aleatorios de \code{kmeans}. Por defecto \code{20}.}

\item{seed}{\code{NULL} o \code{integer}. Semilla para reproducibilidad. Por defecto \code{123}.}

\item{resumen_fun}{\code{c("sum","mean")}. Cómo agregar emociones por comentario. Por defecto \code{"sum"}.}

\item{columnas_map}{\code{NULL} o \code{named list} con mapeo de nombres a usar.
Si \code{NULL} se intenta detectar automáticamente. Ejemplo:
\preformatted{list(
    ira="ira|anger", anticipación="anticipación|anticipacion|anticipation",
    disgusto="disgusto|asco|disgust", miedo="miedo|fear", alegría="alegría|alegria|joy",
    tristeza="tristeza|sadness", sorpresa="sorpresa|surprise", confianza="confianza|trust",
    negativo="negativo|negative", positivo="positivo|positive"
  )}}

\item{na_action}{\code{c("omit","zero","fail")}. Tratamiento de NA en la matriz resumida.}

\item{devolver_etiquetas}{\code{logical}. Si \code{TRUE}, intenta devolver etiquetas
textuales por comentario con \code{obtener_palabra_mas_emocional()} si existe. Por defecto \code{TRUE}.}

\item{"mean"}{(auto) TODO: describir parámetro.}
}
\value{
Una \code{list} con:
\itemize{
\item \code{matriz_emocional}: \code{data.frame} de emociones/polaridades por comentario + \code{cluster} y \code{emocion_predominante}.
\item \code{pca}: objeto \code{prcomp}.
\item \code{proyeccion}: \code{data.frame} con scores del PCA (PC1, PC2, ...).
\item \code{cargas}: \code{data.frame} con loadings del PCA.
\item \code{var_exp}: \code{data.frame} con proporción/acumulada de varianza.
\item \code{clusters}: objeto \code{kmeans}.
\item \code{etiquetas_texto}: \code{character} (si \code{devolver_etiquetas=TRUE} y helper disponible), o \code{NULL}.
\item \code{cols_emociones}: nombres finales de columnas emocionales usadas.
}
}
\description{
Dada una lista de tokens por comentario y una matriz léxica de emociones por token,
resume emociones a nivel de comentario (suma/mean), ejecuta PCA (centrado/escalado),
aplica \emph{k}-means para segmentar y genera etiquetas textuales auxiliares.
Soporta mapeo flexible de nombres NRC y manejo de NA.
}
\details{
\itemize{
\item La función asume que tienes una función helper \code{resumir_emociones_por_comentario()}
que consolida los tokens de cada comentario contra la matriz léxica
(filas = tokens, columnas = emociones/polaridades).
\item Si no cuentas con \code{generar_pca_emocional()}, se usa \code{prcomp()} directamente.
\item \code{kmeans} se ejecuta con \code{nstart} configurable y semilla reproducible.
\item El mapeo de columnas emocionales es flexible: puedes pasar alias como
\code{anger/ira}, \code{joy/alegria}, \code{anticipation/anticipación}, etc.
}
}
\examples{
\dontrun{
# lista_tokens: lista donde cada elemento son tokens del comentario i
# matriz_emociones_traducida: filas = tokens, columnas = emociones NRC + polaridades

out <- procesar_emociones_comentarios(
  lista_tokens = lista_de_tokens,
  matriz_emociones_traducida = matriz_lexica,  # p.ej. resultados$VectorTextoSentimientosNRC
  k = 3, metodo_lexico = "syuzhet", resumen_fun = "sum"
)

# Visualizar PCA con tu función:
g <- graficar_pca_emociones_etiquetas(
  pca = out$pca, data = out$matriz_emocional[, out$cols_emociones, drop=FALSE],
  labels_cluster = out$matriz_emocional$cluster,
  labels_texto   = rownames(out$matriz_emocional),
  palette = "Dark2", biplot = TRUE, top_n_loadings = 10
)
print(g$scatter); print(g$elipses); print(g$biplot)
}
}
\seealso{
Other utilidades: 
\code{\link{DividirPorPercentiles}()},
\code{\link{GenerarDataframeT}()},
\code{\link{LimpiaTexto}()},
\code{\link{TabContingencia_MaxMinXFila}()},
\code{\link{TraduceA}()},
\code{\link{UnirExcelITFF_Optimizada}()},
\code{\link{agregar_recuento_filas}()},
\code{\link{agrupar_emociones}()},
\code{\link{ajustar_gradient_boosting}()},
\code{\link{ajustar_red_nn_unificada}()},
\code{\link{ajustar_regresion_multinomial}()},
\code{\link{ajustar_rnn_regresion}()},
\code{\link{ajustar_rnn_regresion_torch}()},
\code{\link{analizar_coherencia_metodos}()},
\code{\link{analizar_comentarios}()},
\code{\link{analizar_comentarios_ReEscalado}()},
\code{\link{analizar_comentarios_ReEscalado_general}()},
\code{\link{analizar_comentarios_ReEscalado_v3}()},
\code{\link{analizar_comentarios_XP}()},
\code{\link{analizar_consistencia_lexicos}()},
\code{\link{analizar_consistencia_lexicos_v2}()},
\code{\link{analizar_correlaciones_metodos}()},
\code{\link{analizar_emociones_texto}()},
\code{\link{analizar_percentiles_columna}()},
\code{\link{analizar_percentiles_columnaBinaria}()},
\code{\link{analizar_tokens_extremos}()},
\code{\link{anotar_tokens_idioma_simple}()},
\code{\link{as_df_safe}()},
\code{\link{build_emotion_indices}()},
\code{\link{calcular_ensamble_ponderado}()},
\code{\link{calcular_puntaje_emocional}()},
\code{\link{calibrar_metodo_referencia}()},
\code{\link{cambiar_nombres_columnas}()},
\code{\link{categorizar_indices}()},
\code{\link{categorizar_por_percentiles}()},
\code{\link{categorizar_por_percentiles_full}()},
\code{\link{cluster_emotion_spaces}()},
\code{\link{cluster_hclust_cut}()},
\code{\link{cluster_kmeans_auto}()},
\code{\link{configurar_openai_clave}()},
\code{\link{convertir_a_factores_arbol}()},
\code{\link{crear_diccionario_emociones}()},
\code{\link{eliminar_filas_repetidas}()},
\code{\link{eliminarduplicados}()},
\code{\link{emocion_mas_fuerte}()},
\code{\link{estrategia_p1_preparacion}()},
\code{\link{estrategia_p3_ensamble}()},
\code{\link{estrategia_p5_clusters}()},
\code{\link{extraer_features_emocionales}()},
\code{\link{filtrar_diccionario}()},
\code{\link{generar_reporte_html}()},
\code{\link{guardarDataFrameCSV}()},
\code{\link{interseccionDataFrames}()},
\code{\link{leerCSVConNombres}()},
\code{\link{mostrar_diccionario_emociones}()},
\code{\link{p7_exportar_reporte_maestro}()},
\code{\link{pipeline_emociones}()},
\code{\link{predecir_nivel_bin}()},
\code{\link{run_fa}()},
\code{\link{safe_write_csv}()},
\code{\link{segmentar_consistencia_lexicos}()},
\code{\link{simular_arbol}()},
\code{\link{simular_comparacion_todos}()},
\code{\link{simular_random_forest}()},
\code{\link{simular_red_neuronal}()},
\code{\link{simular_red_nn_unificada}()},
\code{\link{simular_regresion}()},
\code{\link{simular_regresion_multinomial}()},
\code{\link{simular_rnn_regresion}()},
\code{\link{simular_rnn_regresion_torch}()},
\code{\link{sp_save}()},
\code{\link{summarize_emotion_space}()},
\code{\link{vector_a_cadena}()},
\code{\link{verificar_clave_openai}()}
}
\concept{utilidades}
